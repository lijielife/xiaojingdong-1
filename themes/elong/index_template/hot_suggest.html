<!-- 城市热门推荐,用户关键词的推荐框,用于用户选择城市后的热门推荐，eg:首页的关键字-->

<div id="h_contentend" style="display:none">
    <div style="position: absolute; z-index: 2000; top: 365px; left: 241.5px;" winstyle="hot">
        <div style="width:300px;" class="com_hotresults">
            <div style="width:100%;">
                <div class="hotel_near" id="hotel_near" >
                    <!-- <p>
                        <tt class="t14 bold">交通枢纽</tt>
                        <br>
                        <span method="hotData" data="0|0">上海站</span>
                        <span method="hotData" data="0|1">上海虹桥站</span>
                        <span method="hotData" data="0|2">上海南站</span>
                        <span method="hotData" data="0|3">上海西站</span>
                        <span method="hotData" data="0|4">上海虹桥机场</span>
                        <span method="hotData" data="0|5">上海浦东机场</span></p>
                    <p>
                        <tt class="t14 bold">地铁站</tt>
                        <br>
                        <span method="hotData" data="1|0">国权路</span>
                        <span method="hotData" data="1|1">海伦路</span>
                        <span method="hotData" data="1|2">航中路</span>
                        <span method="hotData" data="1|3">虹桥1号航站楼</span>
                        <span method="hotData" data="1|4">虹桥2号航站楼</span>
                        <span method="hotData" data="1|5">虹桥火车站</span>
                        <span method="hotData" data="1|6">虹桥路</span>
                        <span method="hotData" data="1|7">江湾体育场</span>
                        <span method="hotData" data="1|8">交通大学</span>
                        <span method="hotData" data="1|9">老西门</span></p>
                    <p>
                        <tt class="t14 bold">热门位置</tt>
                        <br>
                        <span method="hotData" data="2|0">陆家嘴</span>
                        <span method="hotData" data="2|1">外滩</span>
                        <span method="hotData" data="2|2">人民广场</span>
                        <span method="hotData" data="2|3">静安寺</span>
                        <span method="hotData" data="2|4">新国际博览中心</span>
                        <span method="hotData" data="2|5">浦东世博园区</span>
                        <span method="hotData" data="2|6">浦东机场</span>
                        <span method="hotData" data="2|7">五角场商业区</span>
                        <span method="hotData" data="2|8">豫园（城隍庙）</span>
                        <span method="hotData" data="2|9">徐家汇</span></p>
                    <p>
                        <tt class="t14 bold">热门品牌</tt>
                        <br>
                        <span method="hotData" data="3|0">汉庭</span>
                        <span method="hotData" data="3|1">如家</span>
                        <span method="hotData" data="3|2">格林豪泰</span>
                        <span method="hotData" data="3|3">锦江之星</span>
                        <span method="hotData" data="3|4">莫泰</span>
                        <span method="hotData" data="3|5">7天</span>
                        <span method="hotData" data="3|6">99连锁</span>
                        <span method="hotData" data="3|7">布丁</span>
                        <span method="hotData" data="3|8">全季</span>
                        <span method="hotData" data="3|9">速8</span></p> -->
                </div>
            </div>
            <div class="clear"></div>
            <div class="com_cbox_b com_cbox_lt"></div>
            <div class="com_cbox_b com_cbox_rt"></div>
            <div class="com_cbox_b com_cbox_lb"></div>
            <div class="com_cbox_b com_cbox_rb"></div>
            <div class="clear"></div>
        </div>
    </div>
</div>

<div id="s_contentend" style="display:none">
    <div style="position: absolute; z-index: 2000; top: 365px; left: 241.5px;" winstyle="data">
        <div style="width:340px;position:relative;" class="com_results com_hotel_results">
            <div style="width: 100%;">
                <!-- <div class="tuijian">
                    <p method="fromArea" keyword="xizhi">地点在<strong> xizhi</strong> 附近的酒店</p>
                    <p method="fromName" keyword="xizhi">名称含 <strong>xizhi</strong> 的酒店</p>
                </div> -->
                <ul method="ulData">
                    <!-- <li method="liData" data="0" class="ac_odd">
                        <i class="hotel"></i>
                        <span method="spanData" data="0" typeid="9">北京乐家服务式酒店(西直门店)</span>
                    </li> 
                    <li method="liData" data="1" class="ac_odd">
                        <i></i>
                        <span method="spanData" data="1" typeid="9">金泰之家(北京西直门店)</span>
                    </li>
                    <li method="liData" data="2" class="ac_odd">
                        <i class="grass"></i>
                        <span method="spanData" data="2" typeid="999">西直门-地铁站(2号线/4号线/13号线)</span>
                    </li> 
                    <li method="liData" data="3" class="ac_odd">
                        <i></i>
                        <span method="spanData" data="3" typeid="999">西直门</span>
                    </li>
                    <li method="liData" data="4" class="ac_odd">
                        <i></i>
                        <span method="spanData" data="4" typeid="999">西直门地铁站</span>
                    </li> 
                    <li method="liData" data="5" class="ac_odd">
                        <i></i>
                        <span method="spanData" data="5" typeid="999">西直门地铁</span>
                    </li> 
                    <li method="liData" data="6" class="ac_odd">
                        <i></i>
                        <span method="spanData" data="6" typeid="999">西直门汽车客运站</span>
                    </li> 
                    <li method="liData" data="7" class="ac_odd">
                        <i></i>
                        <span method="spanData" data="7" typeid="999">西直门国二招</span>
                    </li> 
                    <li method="liData" data="8" class="ac_odd">
                        <i></i>
                        <span method="spanData" data="8" typeid="999">西直门内大街</span>
                    </li> 
                    <li method="liData" data="9" class="ac_odd">
                        <i></i>
                        <span method="spanData" data="9" typeid="999">西直门站</span>
                    </li> -->
                </ul>
            </div>
            <div class="clear"></div>
            <div class="com_cbox_b com_cbox_lt"></div>
            <div class="com_cbox_b com_cbox_rt"></div>
            <div class="com_cbox_b com_cbox_lb"></div>
            <div class="com_cbox_b com_cbox_rb"></div>
            <div class="clear"></div>
        </div
    div>
</div>

<script type="text/javascript">
    var is_show = false;
    var str = '';  
    var now = ''  
    $(function(){
        $('#keywords').focus(function(){
            var html = '';
            $.ajax({
                url : 'http://openapi.elong.com/suggest/hotsuggest.html?language=cn&cityId=' + $('#hotelCity').attr('cityid'),
                dataType : 'jsonp',
                success : function(data){
                    if(data.length > 0){
                        $(data).each(function(key,val){
                            html += '<p><tt class="t14 bold">' + val['Name'] + '</tt><br>';

                            $(val['TypeNameList']).each(function(k,v){
                                html += '<span method="hotData">' + v['Name'] + '</span>';
                            })
                            html += '</p>';
                        })
                    }
                    if(html != ''){
                        $('#hotel_near').html(html);
                        $('#h_contentend').show();
                        $('#hotel_near span').each(function(){
                            var keyword = $(this).text();
                            $(this).click(function(){
                                $('#keywords').val(keyword);
                                $('#h_contentend').hide();
                            })
                        })
                    }
                },
                error : function(){
                    console.log(url);
                }

            })
        })

        $('#keywords').blur(function(){
            if(!is_show){
                $('#h_contentend').hide();
            }
        })

        $('#h_contentend').mouseenter(function(){
            is_show = true;
        })
        $('#h_contentend').mouseleave(function(){
            is_show = false;
        })
        

        //关键词手动搜索，自动补全
        $('#keywords').bind('focus',function(){
            var time = setInterval(filter_staff_from_exist, 100);  
            $(this).bind('blur',function(){  
                clearInterval(time);  
            }); 
        })
        function filter_staff_from_exist(){  
            now = $.trim($('#keywords').val());  
            if (now != '' && now != str) {
                $.ajax({
                    url : 'hotel_tipwords.php?city=' + $('#hotelCity').val() + '&keywords=' + now,
                    dataType : 'json',
                    success : function(data){
                        var data = data['msg'];
                        if(data.length > 0){
                            var html = '';
                            $(data).each(function(k,v){
                                html += '<li method="liData" class="ac_odd">';
                                if(v['type'] == 'hotel_name'){
                                    html += '<i class="hotel"></i>';
                                }else{
                                    html += '<i></i>';
                                }
                                var preg =  v['keywords'];
                                var replace = '<b>' + v['keywords'] + '</b>';
                                var name = v['name'].replace(preg,replace);
                                html += '<span method="spanData">'+ name +'</span></li>';
                            })
                            $('#s_contentend ul').html(html);
                            $('#h_contentend').hide();
                            $('#s_contentend').show();
                            $('#s_contentend ul li span').each(function(){
                                $(this).click(function(){
                                    var t = $(this).text();
                                    $('#keywords').val(t);
                                    $('#s_contentend').hide();
                                })
                            })
                        }else{
                            $('#h_contentend').hide()
                            $('#s_contentend ul').html('');
                            $('#s_contentend').hide();
                        }
                    },
                    error : function(){
                        console.log('xxx');
                    }
                })
            }  
            str = now;  
        }  

        //搜索按钮绑定
        $('#search_btn1').bind('click',function(){
            var city = $('#hotelCity').val();
            var checkin = $('#checkin').val();
            var checkout = $('#checkout').val();
            var keywords = $('#keywords').val();
            if(!city){
                alert('请先选择入住城市');
                return;
            }
            $(this).hide();
            $(this).next().show();

            $.ajax({
                url : 'hotel_search.php?act=ajax_search_pre&city=' + encodeURI(city),
                dataType : 'json',
                success : function(data){
                    if(data.err == 1){
                        alert(data.msg)
                    }else{
                        //alert('success')
                        var s_url = 'hotel_search.php?act=list&city='+ encodeURI(city) + '&cityid=' + $('#hotelCity').attr('cityid') + '&checkin=' + checkin + '&checkout=' + checkout + '&keywords=' + keywords;
                        window.location.href = s_url;
                    }
                },
                error : function(data){
                    console.log(data);
                }
            })
        })
    })

    
</script>